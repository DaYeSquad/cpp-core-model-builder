<?xml version="1.0"?>
<!-- Version 1.0, C++ code generator of LessChatCore
  - Designed by Frank Lin © 2015-2016
 -->

<!-- Rules:
1. group name should be "user_group".
2. class name should be "UserGroup".
3. variable name should be all lower cases with underscore. There are some attributes you must set in variable:
  - name
  - type : can be 'string', 'bool', 'int', 'string_array', 'time'
           or 'enum', iff you specify the type is enum, you shuold add "enum" attribute to declare the enum class.
  - json_path (eg: 'data/uid'), if the attribute does not have json mapping, you should set an empty string rather than leaving blank (eg: '').
  - [maybe] enum : only affects when type='enum'
  - [maybe] sql_flag can be 'primary_key'
  - [maybe] json_search_path : if the attribute is 'string_array', you can use json_search_path to find the key inside array objects.
4. enum name should be 'Role' (the first letter is upper case), alias should be ALL_UPPER_CASE.
5. manager name should be 'UserManager' (CRUD)
  - <save/> supports "singular"(SaveObjectToCache) and "plural"(SaveObjectsToCache)
  - <fetch/> supports "singular"(FetchObjectFromCache) and "plural"(FetchObjectsFromCache) and "by" (FetchObjectFromCacheById)
  - <delete/> supports "singular"(DeleteObjectFromCache) and "plural"(DeleteObjectsFromCache) and "by" (DeleteObjectFromCacheById)
  - <update/> is not supported in version 1.0
  - WARNING: DO NOT use 'string_array' variable as "by" filter
-->

<module>
  <!-- 用户相关 -->
  <group name='user'>
    <!-- 用户-->
    <class name='User'>
      <manager name='UserManager'>
        <save singular='true'/>
        <save plural='true'/>
        <fetch singular='true' by='uid'/>
        <fetch plural='true'/>
        <delete singular='true'/>
        <delete plural='true'/>
        <delete singular='true' by='uid'/>
        <delete singular='true' by='uid,username'/>
      </manager>
      <enum name='Role'>
        <value int_value='1' alias='MEMBER'/>
        <value int_value='2' alias='ADMIN'/>
        <value int_value='3' alias='GUEST'/>
        <value int_value='4' alias='OWNER'/>
        <value int_value='5' alias='ROBOT'/>
      </enum>
      <enum name='Status'>
        <value int_value='0' alias='OFFLINE'/>
        <value int_value='1' alias='ONLINE'/>
        <value int_value='2' alias='BUSY'/>
        <value int_value='3' alias='AWAY'/>
      </enum>
      <enum name='State'>
        <value int_value='0' alias='ALL'/>
        <value int_value='1' alias='NORMAL'/>
        <value int_value='2' alias='DISABLED'/>
        <value int_value='3' alias='INVITED'/>
        <value int_value='4' alias='PENDING'/>
      </enum>
      <variable name='uid' type='string' json_path='uid' sql_flag='primary_key'/>
      <variable name='username' type='string' json_path='name'/>
      <variable name='display_name' type='string' json_path='display_name'/>
      <variable name='pinyin' type='string' json_path='display_name_pinyin'/>
      <variable name='header_uri' type='string' json_path='avatar'/>
      <variable name='deleted' type='bool' json_path='is_deleted'/>
      <variable name='role' type='enum' enum='User.Role' json_path='role'/>
      <variable name='state' type='enum' enum='User.State' json_path='status'/>
      <variable name='status' type='enum' enum='User.Status' json_path='state'/>
      <variable name='phone_number' type='string' json_path='mobile'/>
      <variable name='job_title' type='string' json_path='title'/>
      <variable name='department' type='string' json_path='department'/>
      <variable name='email' type='string' json_path='email'/>
    </class>
    <!-- 用户关系 (用户与其它对象的关系)-->
    <class name='Membership'>
      <manager name='MembershipManager'>
        <save singular='true'/>
        <save plural='true'/>
        <fetch plural='true' by='uid,type'/>
        <fetch plural='true' by='identifier,type'/>
        <fetch singular='true' by='uid,identifier,type'/>
        <delete singular='true' by='uid,identifier,type'/>
        <delete plural='true'/>
        <delete plural='true' by='identifier,type'/>
      </manager>
      <enum name='Type'>
        <value int_value='0' alias='USER_GROUP'/>
        <value int_value='1' alias='PROJECT'/>
      </enum>
      <variable name='membership_id' type='string' json_path='' sql_flag='primary_key'/>
      <variable name='uid' type='string' json_path='uid'/>
      <variable name='identifier' type='string' json_path=''/>
      <variable name='type' type='enum' enum='Membership.Type' json_path=''/>
    </class>
  </group>
 <!-- App 级别相关 -->
 <group name='application'>
  <!-- 标签 -->
  <class name='Tag'>
    <manager name='TagManager'>
      <save singular='true'/>
      <save plural='true'/>
      <fetch plural='true' by='type'/>
      <fetch singular='true' by='tag_id'/>
      <delete plural='true' by='type'/>
      <delete plural='true'/>
      <delete singular='true' by='tag_id'/>
    </manager>
    <variable name='tag_id' type='string' json_path='_id' sql_flag='primary_key'/>
    <variable name='type' type='enum' enum='ApplicationType' json_path='type'/>
    <variable name='color' type='string' json_path='color'/>
    <variable name='name' type='string' json_path='name'/>
  </class>
  <!-- 赞 -->
  <class name='Like'>
    <manager name='LikeManager'>
      <save singular='true'/>
      <save plural='true'/>
      <fetch plural='true' by='type'/>
      <fetch singular='true' by='like_id'/>
      <fetch plural='true' by='type,application_id'/>
      <delete plural='true' by='type'/>
      <delete plural='true'/>
      <delete singular='true' by='like_id'/>
      <delete plural='true' by='type,application_id'/>
      <delete singular='true' by='type,application_id,created_by'/>
    </manager>
    <variable name='like_id' type='string' json_path='_id' sql_flag='primary_key'/>
    <variable name='type' type='enum' enum='ApplicationType' json_path='type'/>
    <variable name='application_id' type='string' json_path=''/>
    <variable name='created_by' type='string' json_path='created_by'/>
    <variable name='created_at' type='time' json_path='created_at'/>
  </class>
 </group>
 <!-- 任务相关 -->
 <group name='task'>
    <!-- 任务 -->
    <class name='Task'>
      <manager name='TaskManager'>
        <save singular='true'/>
        <save plural='true'/>
        <fetch singular='true' by='task_id'/>
        <fetch plural='true' by='project_id'/>
        <fetch plural='true' by='assigned_to'/>
        <delete plural='true' by='task_id'/>
        <delete plural='true' by='project_id'/>
        <delete plural='true' by='assigned_to'/>
      </manager>
      <enum name='Type'>
        <value int_value='0' alias='NORMAL'/>
        <value int_value='1' alias='TEMPLATE'/>
      </enum>
      <enum name='Priority'>
        <value int_value='1' alias='LOW'/>
        <value int_value='2' alias='NORMAL'/>
        <value int_value='3' alias='HIGH'/>
      </enum>
      <enum name='Visibility'>
        <value int_value='0' alias='PUBLIC'/>
        <value int_value='1' alias='PRIVATE'/>
        <value int_value='2' alias='PERSONAL'/>
      </enum>
      <variable name='task_id' type='string' json_path='_id' sql_flag='primary_key'/>
      <variable name='title' type='string' json_path='title'/>
      <variable name='list_id' type='string' json_path='entry'/>
      <variable name='project_id' type='string' json_path='project/_id'/>

      <variable name='created_at' type='time' json_path='created_at'/>
      <variable name='created_by' type='string' json_path='created_by'/>

      <variable name='last_updated_at' type='time' json_path='updated_at'/>
      <variable name='position' type='int' json_path='position'/>
      <variable name='task_number' type='string' json_path='identifier'/>

      <variable name='archived' type='bool' json_path='is_archived'/>
      <variable name='completed' type='bool' json_path='completion/is_completed'/>
      <variable name='deleted' type='bool' json_path='is_deleted'/>
      <variable name='permission' type='int' json_path='permission'/>

      <variable name='num_comments' type='int' json_path='comment_count'/>
      <variable name='num_attachments' type='int' json_path='attachment_count'/>
      <variable name='num_child_tasks' type='int' json_path='children_count'/>
      <variable name='num_completed_child_tasks' type='int' json_path='completed_children_count'/>
      <variable name='num_like' type='int' json_path='like_count'/>

      <variable name='assigned_to' type='string' json_path='assignment/asignee/uid'/>
      <variable name='assigned_by' type='string' json_path='assignment/assigner/uid'/>

      <variable name='due' type='time' json_path='due_date/date'/>
      <variable name='with_time' type='bool' json_path='due_date/with_time'/>

      <variable name='tags' type='string_array' json_path='tags' json_search_path='_id'/>
      <variable name='watchers' type='string_array' json_path='watchers' json_search_path='uid'/>
      <variable name='comments' type='string_array' json_path='comments' json_search_path='_id'/>
      <variable name='likes' type='string_array' json_path='likes' json_search_path='uid'/>
    </class>
    <!-- 项目分组 -->
    <class name='ProjectGroup'>
      <manager name='ProjectGroupManager'>
        <save singular='true'/>
        <save plural='true'/>
        <fetch plural='true'/>
        <fetch singular='true' by='group_id'/>
        <delete plural='true'/>
        <delete singular='true' by='group_id'/>
      </manager>
      <variable name='group_id' type='string' json_path='_id' sql_flag='primary_key'/>
      <variable name='team_id' type='string' json_path='team'/>
      <variable name='owner' type='string' json_path='owner'/>
      <variable name='name' type='string' json_path='name'/>
      <variable name='position' type='int' json_path='position'/>
    </class>
    <!-- 项目列表 -->
    <class name='List'>
      <manager name='ListManager'>
        <save singular='true'/>
        <save plural='true'/>
        <fetch plural='true'/>
        <fetch plural='true' by='project_id'/>
        <delete plural='true'/>
        <delete plural='true' by='project_id'/>
      </manager>
      <variable name='list_id' type='string' json_path='_id' sql_flag='primary_key'/>
      <variable name='name' type='string' json_path='name'/>
      <variable name='position' type='int' json_path='position'/>
      <variable name='project_id' type='string' json_path=''/>
    </class>
    <!-- 项目 -->
    <class name='Project'>
      <manager name='ProjectManager'>
        <save singular='true'/>
        <save plural='true'/>
        <fetch plural='true'/>
        <fetch singular='true' by='project_id'/>
        <delete plural='true'/>
      </manager>
      <enum name='Visibility'>
        <value int_value='0' alias='PUBLIC'/>
        <value int_value='1' alias='PRIVATE'/>
        <value int_value='2' alias='PERSONAL'/>
      </enum>
      <variable name='project_id' type='string' json_path='_id' sql_flag='primary_key'/>
      <variable name='visibility' type='enum' enum='Project.Visibility' json_path='visibility'/>
      <variable name='color' type='string' json_path='color'/>
      <variable name='name' type='string' json_path='name'/>
      <variable name='group_id' type='string' json_path='group'/>
    </class>
 </group>
 <!-- 与使用者相关 -->
 <group name='director'>
    <class name='Permission'>
      <manager name='PermissionManager'>
        <save singular='true'/>
        <save plural='true'/>
        <fetch plural='true' by='identifier,type'/>
        <delete plural='true'/>
        <delete plural='true' by='identifier,type'/>
      </manager>
      <enum name='Type'>
        <value int_value='0' alias='UNKNOWN'/>
        <value int_value='1' alias='PROJECT'/>
      </enum>
      <variable name='type' type='enum' enum='Permission.Type' json_path=''/>
      <variable name='identifier' type='string' json_path='' sql_flag='primary_key'/>
      <variable name='value' type='int' json_path='permission'/>
    </class>
 </group>
</module>
